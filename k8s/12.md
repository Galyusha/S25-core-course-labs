# Lab 12: Kubernetes ConfigMaps

## Task 1: Upgrade Application for Persistence

### Check `my-django-app`
```bash
PS D:\S25-core-course-labs> curl http://localhost:8000

StatusCode        : 200
StatusDescription : OK
Content           : <h1>Current Time in Moscow: 2025-03-09 22:52:59</h1><p>You are visitor number 4.</p>
RawContent        : HTTP/1.1 200 OK
                    X-Content-Type-Options: nosniff
                    Referrer-Policy: same-origin
                    Cross-Origin-Opener-Policy: same-origin
                    Content-Length: 83
                    Content-Type: text/html; charset=utf-8
                    Date: Sun, 09 Mar 2025 22:52:59 GMT

Forms             : {}
Headers           : {[X-Content-Type-Options, nosniff], [Referrer-Policy, same-origin], [Cross-Origin-Opener-Policy, same-origin], [Content-Length, 83]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 83
```

```bash
PS D:\S25-core-course-labs> curl http://localhost:8000/visits

StatusCode        : 200
StatusDescription : OK
Content           : <h1>Total Visits: 4</h1>
RawContent        : HTTP/1.1 200 OK
                    X-Content-Type-Options: nosniff
                    Referrer-Policy: same-origin
                    Cross-Origin-Opener-Policy: same-origin
                    Content-Length: 24
                    Content-Type: text/html; charset=utf-8
                    Date: Sun, 09 Mar 2025 22:53:00 GMT

Forms             : {}
Headers           : {[X-Content-Type-Options, nosniff], [Referrer-Policy, same-origin], [Cross-Origin-Opener-Policy, same-origin], [Content-Length, 24]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 24
```

### Check `my-dart-app`

```bash
PS D:\S25-core-course-labs> curl http://localhost:8080

StatusCode        : 200
StatusDescription : OK
Content           : <!DOCTYPE html>
                    <html>
                    <head>
                      <!--
                        If you are serving your web app in a path other than the root, change the
                        href value below to reflect the base path you are serving from.

                        The path should end with a slash ("/").
                      -->
                      <base href="/">
                      <meta charset="UTF-8">
                      <meta content="IE=Edge" http-equiv="X-UA-Compatible">
                      <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
                      <meta name="apple-mobile-web-app-capable" content="yes">
                      <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
                      <title>My Dart App</title>
                      <link rel="stylesheet" href="styles.css">
                    </head>
                    <body>
                      <div id="app"></div>
                      <script src="main.dart.js"></script>
                    </body>
                    </html>
RawContent        : HTTP/1.1 200 OK
                    Connection: keep-alive
                    Accept-Ranges: bytes
                    Content-Length: 1261
                    Content-Type: text/html
                    Date: Sun, 09 Mar 2025 19:55:04 GMT
                    ETag: "67cdef91-4ed"
                    Last-Modified: Sun, 09 Mar 2025 19:55:04 GMT

Forms             : {}
Headers           : {[Connection, keep-alive], [Accept-Ranges, bytes], [Content-Length, 1261], [Content-Type, text/html]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 1261
```

```bash
PS D:\S25-core-course-labs> curl http://localhost:8080/visits

StatusCode        : 200
StatusDescription : OK
Content           : <h1>Total Visits: 4</h1>
RawContent        : HTTP/1.1 200 OK
                    Content-Length: 24
                    Content-Type: text/html; charset=utf-8
                    Date: Sun, 09 Mar 2025 19:55:05 GMT

Forms             : {}
Headers           : {[Content-Length, 24], [Content-Type, text/html; charset=utf-8], [Date, Sun, 09 Mar 2025 19:55:05 GMT]}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 24
```

---

## Task 2: ConfigMap Implementation

### Mount a Config File in Both Applications

```bash
PS D:\S25-core-course-labs\k8s> helm upgrade --install my-django-app ./my-django-app
Release "my-django-app" does not exist. Installing it now.
NAME: my-django-app
LAST DEPLOYED: Sun Mar  9 23:24:42 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services my-django-app)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
```

```bash
PS D:\S25-core-course-labs\k8s> helm upgrade --install my-dart-app ./my-dart-app
Release "my-dart-app" does not exist. Installing it now.
NAME: my-dart-app
LAST DEPLOYED: Sun Mar  9 23:29:03 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services my-dart-app)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
```

### List of Pods

```bash
PS D:\S25-core-course-labs\k8s> kubectl get pods
NAME                             READY   STATUS      RESTARTS   AGE
my-dart-app-6867bbff78-6dwrx     1/1     Running     0          5m41s
my-django-app-54d4467545-pp8tx   1/1     Running     0          9m41s
postinstall-hook                 0/1     Completed   0          5m41s
preinstall-hook                  0/1     Completed   0          6m4s
```

### List of ConfigMaps

```bash
PS D:\S25-core-course-labs\k8s> kubectl get configmaps
NAME                   DATA   AGE
kube-root-ca.crt       1      32m
my-dart-app-config     1      6s
my-django-app-config   1      24m
```

### Describe `my-django-app-config`

```bash
PS D:\S25-core-course-labs\k8s> kubectl describe configmap my-django-app-config
Name:         my-django-app-config
Namespace:    default
Labels:       app.kubernetes.io/managed-by=Helm
Annotations:  meta.helm.sh/release-name: my-django-app
              meta.helm.sh/release-namespace: default

Data
====
config.json:
----
{
    "database": {
      "host": "postgres",
      "port": 5432,
      "username": "admin",
      "password": "password"
    },
    "logging": {
      "level": "info",
      "file": "/var/log/app.log"
    }
  }

BinaryData
====

Events:  <none>
```

### Describe `my-dart-app-config`

```bash
PS D:\S25-core-course-labs\k8s> kubectl describe configmap my-dart-app-config
Name:         my-dart-app-config
Namespace:    default
Labels:       app.kubernetes.io/managed-by=Helm
Annotations:  meta.helm.sh/release-name: my-dart-app
              meta.helm.sh/release-namespace: default

Data
====
config.json:
----
{
    "database": {
      "host": "postgres",
      "port": 5432,
      "username": "admin",
      "password": "password"
    },
    "logging": {
      "level": "info",
      "file": "/var/log/app.log"
    }
  }

BinaryData
====

Events:  <none>
```
